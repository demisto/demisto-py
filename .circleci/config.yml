version: 2.0

jobs:
  Python_2.7:
      docker:
        - image: circleci/python:2.7
      steps: &steps
        - checkout
        - run:
            name: Installing Requirements
            command: |
              sudo pip install -r requirements.txt
        - run:
            name: Install Test Requirements
            command: |
              sudo pip install coverage flake8 pytest
        - run:
            name: Verify Versioning
            command: |
              python --version ; pip --version ; pwd ; ls
        - run:
            name: Syntax and Undefined Name Check
            command: |
              flake8 demisto/* --count --select=E901,E999,F821,F822,F823 --show-source --statistics
        - run:
            name: Flake8 Check for Warnings
            command: |
              flake8 demisto/* --count --exit-zero --max-line-length=127 --statistics
        - run:
            name: Check PyLint
            command: |
              pylint demisto/* -E -f parseable --generated-members=requests.packages.urllib3,requests.codes.ok
        - run:
            name: Check coverage
            command: |
              coverage run demisto/client.py
        - run:
            name: Gather Coverage Report
            command: |
              mkdir test-reports
              coverage report && coverage xml -o test-reports/coverage.xml
        - store_test_results:
            path: test-reports
        - store_artifacts:
            path: test-reports
  Python_3.6:
      docker:
        - image: circleci/python:3.6
      steps: *steps

workflows:
  version: 2
  build:
    jobs:
      - Python_2.7
      - Python_3.6
